---
title: "ExerciseB"
format: pdf
editor: visual
---

## Exercise B

We start by loading the data from the csv 

```{r, echo=FALSE}

#install.packages("vctrs")

library(caret)
library(tidyverse)
library(dplyr)
library(labelled)
library(GGally)
library(ggplot2)
library(ggthemes)

#install.packages("caret", dependencies = TRUE) 

library(splines)
library(caTools)
library(lme4)

#install.packages("MASS")
#library(Metrics)
library(MASS)

##https://stackoverflow.com/questions/60451908/tidyverse-not-loaded-it-says-namespace-vctrs-0-2-0-is-already-loaded-but


```

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}
dataWeightHeight = read_csv("C:/AppliedDataScienceAndStatistics/Applied-Data-Science-and-Statistics/Term1/ApplicationOfDataAndStats/Assignment/datasets-20221221/weight_height.csv")
  

```

## Initial exploratory data analysis.

Before we build our initial graph we will check if all the collums have the right data structure

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}

str(dataWeightHeight)  

```

As suspected, they don't as the gender collum is loaded as a numerical, which does not make sense as a male is not bigger or smaller than a female.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}
dataWeightHeight$male = as.factor(dataWeightHeight$male)  

# Change column name of the male column to become more explicit while we are at it
colnames(dataWeightHeight)[colnames(dataWeightHeight) == "male"] <- "isMale"

str(dataWeightHeight) 

```

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}

ggpairs(dataWeightHeight,
        lower = list(continuous = "smooth"),
        diag=list(continuous = "barDiag"),
        axisLabels= "show")

```

Looking at the height histogram it seems that height follows a normal distribution that is very heavily skewed to the left.
The weight seem to follow a bimodal distribution, a distribution that is a mixture of two distinct distributions with same variance but different mean, of two normal distributions.
Age seems to follow a slowly decreasing exponential distribution with a very high outlier in the middle.
As for gender we can see there is slightly more female entries then male entries.
More importantly comparing the other values with weight:
Height follows a curvilinear increase that appears to increase almost exponentially.
Age on the first half of the value range seems to follow a pretty linear relationship with weight till around age 30 where it has a pretty sharp increase in standard error compared to the average of the values.
Furthermore, males follows the a very similar bimodal relationship to females but the males right distribution is more tilted to the right than the female one.
Comparing the independent variables with weight, height seems to have a exponential relationship with weight as the increase was initially minimal but it gradually increases. 
Lastly, age after 30 years of age seems to a very big variance on its relationship with weight making is a much less reliable weight predictor.


##Data separation prior to modeling

Before starting to compute our models we will first separate the data into training and testing data sets, using the caTools library

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}

#make this example reproducible
set.seed(1)

#use 80% of dataset as training set and 20% as test set
sample <-  sample.split(dataWeightHeight$weight, SplitRatio = 0.8) 
##note that the column selected above can be any column.
train  <- dataWeightHeight[sample, ]
test   <- dataWeightHeight[!sample, ]
          
```

## Linear model
```{r tidy=TRUE, tidy.opts=list(width.cutoff=72), echo=FALSE}

# Fit the model
model1 <- lm(weight ~ height + age + isMale, data = train)
# Make predictions
predictions <- model1 %>% predict(test)
# Model performance
model1_performance <- data.frame(
RMSE = RMSE(predictions, test$weight),
R2 = R2(predictions, test$weight)
)


summary(model1)
model1_performance


          
```

As we can see from the  R-squared a simple linear model already explains approximately 89,6% of the variance that influence a person's weight.
According to our RMSE this model will on average have a prediction error of 4.849264.
Also from the p-values we can see that the gender is not as significant as the other values and therefore I will be removing it on the next model



Next we will try to improve the predictive power of our model by changing the relationship between height and weight from a simple linear regression to better represent the exponential increase height to weight. 

## Improved model

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72), echo=FALSE}

#dataWeightHeight$heightLogged = log(dataWeightHeight$height)
#dataWeightHeight$weighttLogged = log(dataWeightHeight$weight)


# Fit the model
model2 <- lm( log(weight) ~ log(height) + age, data = train)
# Make predictions
predictions <- model2 %>% predict(test)
# Model performance
model2_performance <- data.frame(
RMSE = RMSE(predictions, log(test$weight)),
R2 = R2(predictions, log(test$weight))
)


summary(model2)
model2_performance


          
```

As we can immediately see is that we have managed to increase the R-squared value from 89,6% to 96,5% which is a significant upgrade.
The RMSE value has also been massively improved, reducing the average error from 4.849264 to a mere 0.1086593 meaning our model has very little prediction error now.

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}

```

do residuals vs fit? qq 





































