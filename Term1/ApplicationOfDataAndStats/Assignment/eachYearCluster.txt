## as data from 0:00 to 7:50

tenMinuteMaximum = January_2013[,-c(1:2)]

## first we need to the maximum power output of the day i

maxVal = 0
January_2013$max = 0


for (i in 1:nrow(tenMinuteMaximum)) {
  

  
  ##  the apply() function is used with the MARGIN parameter set to 1, which applies the function to all rows of the dataframe. Inside the function, we are checking if the row name is not equal to substation as the substation number is also bigger than the power measured in the interval of 10 mins
  
maxVal = apply(tenMinuteMaximum[i,], 1, max)

#tenMinuteMaximum

January_2013$max[i] = maxVal  


}

January_2013[,3:146] = January_2013[,3:146]/January_2013$max
  

January_2013


January_2013Grouped  = January_2013 %>%  group_by(Substation) %>% summarise_all(mean)

January_2013Grouped = January_2013Grouped[,-c(2)]
  
January_2013Grouped


```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}

#cut the dendrogram into 4 clusters
groups <- cutree(cluster, k=4)

#find number of observations in each cluster
table(groups)

##now I will have to get an average of the entire cluster to plot

January_2013GroupedCluster = cbind(January_2013Grouped, cluster = groups)

## we will have to convert it to factor

January_2013GroupedCluster$cluster = as.factor(January_2013GroupedCluster$cluster)


```

```{r tidy=TRUE, tidy.opts=list(width.cutoff=72)}

## now we will be grouping by cluster to be able to have the average of each time interval

January_2013GroupedClusterAverage =January_2013GroupedCluster %>% group_by(cluster)  %>% summarise_all(mean)


## we got to transform this into vertical data so we can have a colum of time and the power percent to plot

January_2013GroupedClusterAverageVertical = transpose(January_2013GroupedClusterAverage)


# Change colnames of all columns
colnames(January_2013GroupedClusterAverageVertical) <- c("Cluster1", "Cluster2", "Cluster3", "Cluster4")

## we will also be dropping the first row as we no longer need the cluster variables and these will interfere with the plotting
January_2013GroupedClusterAverageVertical = January_2013GroupedClusterAverageVertical[-1,]

## we will also be dropping the last row as we no longer need the max values and these will interfere with the plotting as well

January_2013GroupedClusterAverageVertical = January_2013GroupedClusterAverageVertical[-nrow(January_2013GroupedClusterAverageVertical), ]

```