function chordMpr(g,e){var j={},h={},c=0,k=[],d=[],a,f;var b=new Hash();j.setFilter=function(l){a=l;return this},j.setAccessor=function(l){f=l;return this},j.setMetaAccessor=function(l){metaAccessor=l;return this},j.getCountryMetaData=function(){for(i=0;i<e.length;i++){b.setItem(e[i].Country,e[i].MetaData)}return b},j.getMetaMatrix=function(){return d},j.getMatrix=function(){k=[];_.each(h,function(l){if(!k[l.id]){k[l.id]=[];d[l.id]=[]}_.each(h,function(m){var n=_.filter(g,function(o){return a(o,l,m)});k[l.id][m.id]=f(n,l,m);d[l.id][m.id]=metaAccessor(n,l,m)})});return k},j.getMap=function(){return h},j.printMatrix=function(){_.each(k,function(l){console.log(l)})},j.addToMap=function(l,m){if(!h[l]){h[l]={name:l,id:c++,data:m}}},j.addValuesToMap=function(n,m){var l=_.uniq(_.pluck(g,n));_.map(l,function(o){if(!h[o]){h[o]={name:o,id:c++,data:m}}});return this};return j}function chordRdr(b,a,c,d){return function(n){var h,f,r,p,l,e={};if(n.source){h=n.source.index;f=n.target.index;r=_.where(a,{id:h});p=_.where(a,{id:f});var q=c[h][f].split("~");e.INbrOfProduct=q[0];e.IPartnerShare=q[1];e.ENbrOfProduct=q[2];e.EPartnerShare=q[3];e.TradeBalance=q[4];e.sIndex=h;e.tIndex=f;e.sname=r[0].name;e.sdata=n.source.value;e.svalue=+n.source.value;e.stotal=_.reduce(b[h],function(g,j){return g+j},0);e.tname=p[0].name;e.tdata=n.target.value;e.tvalue=+n.target.value;e.ttotal=_.reduce(b[f],function(g,j){return g+j},0)}else{var o=d;l=_.where(a,{id:n.index});e.gname=l[0].name;e.imports="";e.exports="";e.balance="";if(d.getItem(l[0].name)!=undefined){var k=d.getItem(l[0].name).split("~");if(k.length==3){e.imports=k[0];e.exports=k[1];e.balance=k[2]}}e.gdata=l[0].data;e.gvalue=n.value}e.mtotal=_.reduce(b,function(g,j){return g+_.reduce(j,function(m,s){return m+s},0)},0);return e}};