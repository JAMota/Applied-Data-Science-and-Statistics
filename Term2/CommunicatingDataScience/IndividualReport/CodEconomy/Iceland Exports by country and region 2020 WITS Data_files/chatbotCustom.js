var widgetElement;$(document).ready(function(){setTimeout(function(){$(".bodyClass").height($(window).height())},1000);widgetElement=create();$(".optMultiLangChatBot").on("click",function(b){b.stopImmediatePropagation();b.preventDefault();$(".wc-shellinput").attr("placeholder","Ask questions like World Trade or Tariff");$("span:first",".wc-header").text("WITS Chat");$(".chatBotDiv").removeClass("chatBotMinWidth");if($(".welcomeMessages").length==0){$(".error").remove();$("#webchat").show();$(".chatBotDiv").removeAttr("style");$(".btnChat").hide();if($(".chatBotDiv").find(".resize").hasClass("active")){$(".chatBotDiv").removeClass("height0");$(".chatBotDiv").removeClass("height40");$(".chatBotDiv").addClass("height385");$(".chatBotDiv").removeClass("chatBotActive");$(".chatBotDiv").find(".resize").removeClass("active")}else{$(".chatBotDiv").addClass("chatBotActive");$(".chatBotDiv").find(".resize").addClass("active");$(".chatBotDiv").removeClass("height40");$(".chatBotDiv").removeClass("height0");$(".chatBotDiv").removeClass("height385")}$(".chatBotDiv").find(".ui-resizable-handle").show();$(".chatBotDiv").find(".wc-shellinput").focus();$(".chatBotDiv").find(".wc-shellinput").val("");$(".wc-send").attr("title","Send");var a;if(widgetElement.options.chatBotDisable){a=widgetElement.messageTemplate(widgetElement.options.messageUnavailable,"welcomeMessages disabledText");$(".welcomeMessages").remove();$(".wc-message-group-content").append(a);$(".wc-shellinput").prop("disabled",true);$(".wc-send").prop("disabled",true);$(".wc-send").removeAttr("title");$(".wc-send").css("cursor","text")}else{widgetElement.addWelcomeMeassage();widgetElement.options.isMetadata=widgetElement.options.metaDataDefault;if(widgetElement.options.Wizard==false){$(".narrowSearchSpn").remove()}}$(".wc-footer").show()}})});function create(){if($(".chatBotDiv").is(":WITS-ChatBot")){$(".chatBotDiv").ChatBot("destroy")}$(".chatBotDiv").ChatBot();return $(".chatBotDiv").ChatBot("instance")}function reCreate(){$(".chatBotDiv").empty();widgetElement=create()}if(top.location!=location){top.location.href=document.location.href}(function(a){a.widget("WITS.ChatBot",{options:{secretKey:undefined,user:"You",autoComplete:false,messageStart:"Hi. How can I help you?",messageUnavailable:"Chatbot is unavailable and try again later. You can always reach us at <a href='mailto:wits@worldbank.org'>wits@worldbank.org</a>",messageChatBotClosing:"You have reached the maximum limit of Questions that can be asked in a single session. Wits Chat will close automatically.",botId:"α-Bot",autoCompleteUrl:Svrpath+"ChatBotCustom.aspx/AutoComplete",ipAddress:Svrpath+"ChatBotCustom.aspx/IpAddress",saveAnswer:Svrpath+"ChatBotCustom.aspx/SaveAnswer",validEnitityUrl:Svrpath+"ChatBotCustom.aspx/ValidEntity",recentlyAskedQuestionsURL:Svrpath+"chatbot/Recently-asked-questions.aspx",isQnA:false,isDataSearch:true,isNarrowSearch:false,isMetadata:false,metaDataDefault:true,reset:false,fromExit:false,detailedHelpUrl:"https://wits.worldbank.org/Help/Chatbot-help.html",tradeStaticsByProduct:"https://wits.worldbank.org/trade/country-byhs6product.aspx",tradeUrl:"https://wits.worldbank.org/trade/country-byhs6product.aspx?lang=en",tariffUrl:"https://wits.worldbank.org/tariff/trains/country-byhs6product.aspx?lang=en",validCaptchaUrl:Svrpath+"ChatBotCustom.aspx/ValidCaptcha",headerText:'WITS <span class="slogText">Chat</span>',subHeader:"Ask questions like world exports, or tariff data <a onmousedown='return false' class='moreLink' href='https://wits.worldbank.org/Help/Chatbot-help.html' target='_blank'>More</a>",errorMessages:"",productCodeText:""},isCountry:false,isPartner:false,isProduct:false,isIndicator:false,startYear:false,endYear:false,exitWizad:false,narrowSearch:false,narrowText:false,startYearValue:0,yearValidation:false,autocompleteData:[],productIndexData:[],errorMessage:false,_create:function(){this.setOptions();this.createTemplate();this.callBot();this.configure();this.getIPAddress();this.eventManager()},setOptions:function(){var b=this;a.ajax({url:Svrpath+"ChatBotCustom.aspx/GetConfigKeys",type:"POST",async:false,contentType:"application/json; charset=utf-8",dataType:"json",success:function(c){b.options.chatBotDisable=c.d.ChatBotDisable.toLowerCase()=="true"?true:false;if(!b.options.chatBotDisable){b.options.Wizard=c.d.Wizard.toLowerCase()=="true"?true:false;b.options.MaxYear=c.d.MaxYear;b.options.MinYear=c.d.MinYear;b.options.secretKey=c.d.SecretKey;b.options.enableChatBotClose=c.d.EnableChatBotClose.toLowerCase()=="true"?true:false;b.options.chatBotClosingCount=c.d.ChatBotClosingCount;b.options.autoCompleteMinLength=c.d.AutoCompleteMinLength;b.options.fullTextSearch=c.d.FullTextSearch.toLowerCase()=="true"?true:false;b.options.autoComplete=c.d.AutoComplete.toLowerCase()=="true"?true:false;b.options.numberOfCharacter=c.d.NumberOfCharacter;b.options.trimMainTitle=parseInt(c.d.TrimMainTitle);b.options.trimSubTitle=parseInt(c.d.TrimSubTitle);b.options.characterAllowed=c.d.CharacterAllowed;b.options.botId=c.d.BotName;if(b.options.secretKey=="Error"){b.options.chatBotDisable=true}b.options.showQnA=c.d.showKB.toLowerCase()=="true"?true:false;b.options.showMetaData=c.d.showMetaData.toLowerCase()=="true"?true:false;b.options.showNarrowSearch=c.d.showNarrowSearch.toLowerCase()=="true"?true:false;b.options.KBTrimSubTitle=parseInt(c.d.KBTrimSubTitle)}}})},redraw:function(){this.element.empty();this.destroy();this.createTemplate();this.callBot();this.configure();this.eventManager()},_destroy:function(){this.element.find("#webchat").remove()},createTemplate:function(){var b=this;var c='<div id="webchat" role="main"></div><div class="btnChat"><span>'+b.options.headerText+'</span><div class="btnSnippet"><span class="pipe"></span><div class="expand toggleIcon maxActive" title="Maximize"></div><span class="pipe"></span><div class="resize" title="Resize"></div><span class="pipe"></span><div class="closeChat" title="Close"></div></div></div>';b.element.empty().append(c)},callBot:function(){var b=this;BotChat.App({directLine:{token:b.options.secretKey},user:{id:b.options.user},bot:{id:b.options.botId},resize:"detect"},document.getElementById("webchat"));b.dynamicallyLoadScript(Svrpath+"ChatBot/data/greetings_v_2020_04_22.js");b.dynamicallyLoadScript(Svrpath+"ChatBot/data/country_v_2019_06_07.js");b.dynamicallyLoadScript(Svrpath+"ChatBot/data/product_v_2019_06_07.js");b.dynamicallyLoadScript(Svrpath+"ChatBot/data/indicator_v_2019_06_07.js");b.dynamicallyLoadScript(Svrpath+"ChatBot/data/productIndex_v_2019_06_07.js")},configure:function(){var b=this;b.questionCount=0;b.captchaCount=0;b.element.find(".spnwc-header").html(b.options.headerText);b.element.find(".wc-header").append('<div class="btnSnippet"><span class="pipe"></span><div class="expand toggleIcon" title="Minimize"></div><span class="pipe"></span><div class="resize" title="Resize"></div><span class="pipe"></span><div class="closeChat" title="Close"></div></div>');Vue.component("headerchat",{template:'<div class = "chatBotSubHeader"><div class="labelCriteria">Select your search criteria</div><div id="dataSearch" class="dataSearch active seachTypeTab" :class="getClass()" title="Data Search" v-on:click="tabClick($event)"><span class="serachTypeIcn" v-on:click="searchClick($event, \'datasearch\')"></span><span class="serachTypeText" v-on:click="searchClick($event, \'datasearch\')">Data Search</span></div><div v-if="showMetaData && isDataSearch" id="metaDataDiv" class="metaDataDiv">Include Metadata: <span class="onOffMeta" data-value="on"><div class="onoffswitch"><input type="checkbox" name="onoffswitch" class= "onoffswitch-checkbox" id="myonoffswitch" v-on:click="metaDataClick($event)" :checked="metaDataDefault"><label class="onoffswitch-label" for="myonoffswitch"><span class="onoffswitch-inner"></span><span class="onoffswitch-switch"></span></label></div></span></div> <div v-if="showNarrowSearch" id="narrowSearchIcn" class="narrowSearchIcn seachTypeTab" :class="getClass()" title="Narrow Search" v-on:click="tabClick($event)"><span class="serachTypeIcn" v-on:click="searchClick($event, \'narrowsearch\')"></span><span class="serachTypeText" v-on:click="searchClick($event, \'narrowsearch\')">Narrow Search</span></div><div v-if="showQnA" id="qnaSearch" class="qnaSearch seachTypeTab" :class="getClass()" title="Knowledge Search" v-on:click="tabClick($event)"><span class="serachTypeIcn" v-on:click="searchClick($event, \'kbsearch\')"></span><span class="serachTypeText" v-on:click="searchClick($event, \'kbsearch\')">Knowledge Search</span></div><div class="detailedHelp" title="Detailed Help" v-on:click="goToDetailedHelp($event)"></div><div class="faqDiv" title="Recently Asked Questions"  v-on:click="goToRecentlyAskedQuestion($event)"></div></div>',data:function(){return{showQnA:this.$parent.showQnA,showMetaData:this.$parent.showMetaData,showNarrowSearch:this.$parent.showNarrowSearch,isDataSearch:true,metaDataDefault:b.options.metaDataDefault}},mounted:function(){if(b.options.chatBotDisable){a(".metaDataDiv").remove()}},methods:{tabClick:function(d){a(d.target).find(".serachTypeText").click()},searchClick:function(k,j){var h=a(k.target).parents(".seachTypeTab");if(b.options.reset){if(a(".wc-message-wrapper:last-child").hasClass("error")){a(".wc-message-wrapper.error").remove()}var d=b.messageTemplate("Please reset the narrow search.","error");a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000);a(".wc-message-group-content").append(d)}if(!b.options.chatBotDisable&&!h.hasClass("active")&&!h.hasClass("disabled")&&!b.options.reset){var g=this.$el.getElementsByClassName("seachTypeTab");if(g.length>0){for(var f=0;f<this.$el.getElementsByClassName("seachTypeTab").length;f++){this.$el.getElementsByClassName("seachTypeTab")[f].classList.remove("active")}}h.addClass("active");if(!b.options.fromExit&&b.options.isNarrowSearch&&j!="narrowsearch"){a(".wc-shellinput").prop("value","Exit Wizard");a(".wc-send").click();a(".wc-message-group-content > .wc-message-wrapper:last-child").remove();a(".wc-shellinput").prop("value","")}b.options.fromExit=false;b.options.isDataSearch=false;b.options.isNarrowSearch=false;b.options.isQnA=false;a(".error").remove();switch(j){case"datasearch":b.options.isDataSearch=true;b.options.isMetadata=true;this.isDataSearch=true;if(a(".wc-shellinput").hasClass("ui-autocomplete-input")){a(".wc-shellinput").autocomplete("destroy")}a(".wc-shellinput").attr("disabled",false).focus();a(".wc-shellinput").attr("placeholder","Ask questions like World Trade or Tariff");break;case"narrowsearch":this.isDataSearch=false;b.options.isNarrowSearch=true;a(".seachTypeTab").addClass("disabled");a(".wc-shellinput").prop("value","narrow search");a(".wc-send").click();a(".wc-message-group-content > .wc-message-wrapper:last-child").remove();a(".wc-shellinput").prop("value","");a(".wc-shellinput").attr("placeholder","Please select a selection filter like Country, Product …");a(".wc-shellinput").attr("disabled",true);break;case"kbsearch":b.options.isQnA=true;this.isDataSearch=false;if(a(".wc-shellinput").hasClass("ui-autocomplete-input")){a(".wc-shellinput").autocomplete("destroy")}a(".wc-shellinput").attr("disabled",false).focus();a(".wc-shellinput").attr("placeholder","Ask question like what is simple average tariff or about RCA or about simple average");break}b.addWelcomeMeassage()}},metaDataClick:function(f){b.options.isMetadata=f.target.checked==true;for(var d=0;d<document.getElementsByClassName("onoffswitch-checkbox_1").length;d++){document.getElementsByClassName("onoffswitch-checkbox_1")[d].click()}},goToRecentlyAskedQuestion:function(f){var d=document.createElement("a");d.setAttribute("type","hidden");a(".chatBotDiv").removeClass("chatBotMinWidth");d.setAttribute("href",b.options.recentlyAskedQuestionsURL);d.setAttribute("target","_blank");d.innerHTML="link text";document.body.appendChild(d);d.click();d.remove()},goToDetailedHelp:function(f){var d=document.createElement("a");d.setAttribute("type","hidden");a(".chatBotDiv").removeClass("chatBotMinWidth");d.setAttribute("href",b.options.detailedHelpUrl);d.setAttribute("target","_blank");d.innerHTML="link text";document.body.appendChild(d);d.click();d.remove()},getClass:function(){if(!b.options.chatBotDisable){return"cursorPointer"}}}});b.element.find(".wc-message-pane").prepend('<div class="headerChat"><headerchat></headerchat></div><div class="divPopup"></div>');var c=new Vue({el:".headerChat",data:{showQnA:b.options.showQnA,showMetaData:b.options.showMetaData,showNarrowSearch:b.options.showNarrowSearch}});b.element.find("#webchat").append('<div class="wc-footer"><a onmousedown="return false" class="moreLink footerLink" href="https://groups.google.com/forum/#!forum/witsforum" target="_blank">WITS forum</a><a onmousedown="return false" class="moreLink footerLink" href="mailto:wits@worldbank.org">wits@worldbank.org</a></div>');b.element.find(".wc-shellinput").attr("maxlength",b.options.numberOfCharacter);b.element.resizable({animate:true,maxWidth:b.element.parents(".bodyClass").width()-18,maxHeight:b.element.parents(".bodyClass").height()-20,handles:"n, w, nw"});b.element.find(".ui-resizable-handle").hide()},welcomeTemplate:function(d,c){var b=this;return'<div class="wc-message wc-message-from-bot '+c+'" style="max-width:100%;"><div class="wc-message-content" style="float:left;"><div class="format-markdown"><p><span class= "welcomeMsg headmsg">'+d+'</span> <span class="welcomeMsg">Please select your search criteria</span><span class="eachOptions"><span class= "welcomeMsgEachItem"><div class="eachRow"><span class="leftPart">I.</span><span class="rightPart"><span style="float:left;width: 100%;">Search Data</span></span><span class="lastPart" style="margin-left: 36px;"><span class="dataSearchIconNew" title="Data Search" onclick="searchClick(\'datasearch\')"></span></span></div><div class="eachRow"><span class="leftPart yesnoFilter"></span><span class="rightPart"><span class="withOption" style="float:left;"> (with or without metadata)</span></span><span class="lastPart"><span class="withOption" style="float:left;"><span class= "onoffswitch_1"><input type="checkbox" name="onoffswitch_1" id="myonoffswitch_1" class= "onoffswitch-checkbox_1" onchange="onOffChange()"/><label class="onoffswitch-label_1" for="myonoffswitch_1"><span class="onoffswitch-inner_1"></span><span class="onoffswitch-switch_1"></span></label></span></span></span></span> </div><span class= "welcomeMsgEachItem"><div class="eachRow"><span class="leftPart">II.</span><span class="rightPart"><span style="float: left;">Help me find data </span></span><span class="lastPart"><span class="narrowSearchIcnNew" title="Narrow Search" onclick="searchClick(\'narrowsearch\')"></span></span></div></span><span class= "welcomeMsgEachItem kbSearchDiv"><span class="eachRow"><span class="leftPart">III.</span><span class="rightPart"><span style="float: left;">Search Knowledge</span></span><span class="lastPart" style="margin-left: 0px;"><span class="kbSearchIconNew" title="Knowledge Search" onclick="searchClick(\'kbsearch\')"></span></span></span></span></span></span><span style="padding: 5px 0px; width: 100 %; float: left;" class="eachRow"><span style="float: left;"> Browse </span><span style="float: left;"><a class="welcomeRAMsgs" style="float: left; margin-left: 5px; margin-right: 3px;" href="/chatbot/Recently-asked-questions.aspx" target="_blank"> recently asked questions </a></span><span style="float: left; margin-right:3px;"> and Get more </span><span style="float: left;"><a href="'+b.options.detailedHelpUrl+'" target="_blank"> detailed help </a></span></span><span class="eachRow"><span style = "float: left;"> Browse </span><a class="hs6Data" style="float: left; margin-left: 5px; margin-right: 3px;" href="'+b.options.tradeUrl+'" target="_blank">trade</a><span style = "float: left;"> and </span><a class="hs6Data" style="float: left; margin-left: 5px; margin-right: 3px;" href="'+b.options.tariffUrl+'" target="_blank">tariff</a><span style="float: left; margin-right: 3px;">data at </span>HS 6-digit product-level</span></p></div></div></div><div class="wc-message-from wc-message-from-bot dateTimeDiv '+c+'"><span>'+b.options.botId+" at "+b.getTime(new Date)+"</span></div>"},addWelcomeMeassage:function(){var b=this;var d='<b>Hi Good Day ! </b>Use this chatbot in <span class="countWays">two</span> ways';if(a(".welcomeMessages").length==0){var c='<div class="wc-message-wrapper list welcomeMessages" data-activity-id=""></div>';a(".wc-message-group-content").append(c)}a.each(a(".welcomeMessages"),function(e,f){a(f).empty().append(b.welcomeTemplate(d))});a(".yesnoFilter").append("&nbsp;");if(b.options.metaDataDefault){a("#myonoffswitch_1").attr("checked",true)}if(b.options.isDataSearch){a(".dataSearchIconNew").remove()}if(!b.options.showMetaData){a(".yesnoFilter").empty();a(".withOption").remove()}else{if(!b.options.isDataSearch){a(".yesnoFilter").empty();a(".withOption").remove()}}if(b.options.isNarrowSearch){a(".narrowSearchIcnNew").remove()}if(!b.options.showQnA){a(".kbSearchDiv").remove()}else{a(".countWays").text("three")}if(b.options.isQnA){a(".kbSearchIconNew").remove()}a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000)},autoComplete:function(c){var b=this;if(c=="Country"){b.autocompleteData=countryJson;b.isCountry=true;b.isProduct=false;b.isPartner=false;b.isIndicator=false}if(c=="Partner"){b.autocompleteData=countryJson;b.isPartner=true;b.isCountry=false;b.isProduct=false;b.isIndicator=false}else{if(c=="Product"){b.autocompleteData=productJson;b.productIndexData=productIndexJson;b.isProduct=true;b.isCountry=false;b.isPartner=false;b.isIndicator=false}else{if(c=="Indicator"){b.autocompleteData=indicatorJson;b.isIndicator=true;b.isProduct=false;b.isCountry=false;b.isPartner=false}}}a(".wc-shellinput").autocomplete({selectFirst:true,minLength:b.options.autoCompleteMinLength,autoFocus:true,appendTo:"#webchat",focus:function(f,d){if(d.item!=null){if(a(this).data("ui-autocomplete")){a(this).data("ui-autocomplete").menu.element.find("li div").removeClass("selectedLi");a(this).data("ui-autocomplete").menu.element.find("li div.ui-state-active").addClass("selectedLi")}}return false},select:function(d,e){d.preventDefault();b.element.find(".wc-shellinput").val(e.item.value);a(".wc-send").click();return true},source:function(f,d){if(c=="Country"){var e=a.map(b.autocompleteData,function(g){if(g.name.toLowerCase().startsWith(f.term.toLowerCase())&&g.isReporter=="1"){return g.name}});d(e)}else{if(c=="Product"){e=a.map(b.autocompleteData,function(l){if(l.Entity.toLowerCase().startsWith(f.term.toLowerCase())){var j=[];var g=l.ProductGroupIndex.split("|");if(g.length>1){j.push(l.Entity+"(All Sector)")}for(var h=0;h<g.length;h++){var k=g[h];a.map(b.productIndexData,function(m){if(m.Index.toLowerCase().startsWith(k.toLowerCase())){j.push(l.Entity+"("+m.ProductGroupDescription+")")}})}return j}});d(e)}else{if(c=="Indicator"){e=a.map(b.autocompleteData,function(g){if(g.name.toLowerCase().startsWith(f.term.toLowerCase())){return g.name}});d(e)}else{if(c=="Partner"){e=a.map(b.autocompleteData,function(g){if(g.name.toLowerCase().startsWith(f.term.toLowerCase())&&g.isPartner=="1"){return g.name}});d(e)}}}}},position:{my:"left bottom",at:"left top",collision:"flip"}})},messageTemplate:function(c,b){return'<div class="wc-message-wrapper list '+b+'" data-activity-id=""><div class="wc-message wc-message-from-bot" style="max-width:100%;"><div class="wc-message-content" style="float:left;"><div><div class="format-markdown"><p>'+c+'</p></div ></div ></div ></div > <div class="wc-message-from wc-message-from-bot"><span>'+this.options.botId+" at "+this.getTime(new Date)+"</span></div></div>"},messageFromYouTemplate:function(c,b){return'<div class="wc-message-wrapper list '+b+'" data-activity-id=""><div class="wc-message wc-message-from-me" style="max-width:100%;"><div class="wc-message-content" style="float:left;"><div><div class="format-markdown"><p>'+c+'</p></div ></div ></div ></div > <div class="wc-message-from wc-message-from-me"><span>'+this.options.botId+" at "+this.getTime(new Date)+"</span></div></div>"},eventManager:function(){var c=this;a(document).on("click",".closeChat",function(f){f.preventDefault();f.stopImmediatePropagation();var d=a(".chatBotDiv").parent();a(".chatBotDiv").removeClass("height40");a(".chatBotDiv").removeClass("height385");a(".chatBotDiv").removeClass("chatBotActive");a(".chatBotDiv").addClass("height0");reCreate()});a(document).on("click",".resize",function(d){d.preventDefault();d.stopImmediatePropagation();a("#webchat").hide();c.element.removeAttr("style");a("#webchat").hide();a("#webchat").show();c.element.removeAttr("style");a(".btnChat").hide();a(".chatBotDiv").removeClass("chatBotMinWidth");if(c.element.find(".resize").hasClass("active")){a(c.element).removeClass("height0");a(c.element).removeClass("height40");a(c.element).addClass("height385");c.element.removeClass("chatBotActive");c.element.find(".resize").removeClass("active")}else{c.element.addClass("chatBotActive");c.element.find(".resize").addClass("active");a(c.element).removeClass("height40");a(c.element).removeClass("height0");a(c.element).removeClass("height385")}a(".wc-shellinput").focus()});a(".expand.toggleIcon:not(.maxActive)").on("click",function(d){d.preventDefault();d.stopImmediatePropagation();a("#webchat").hide();c.element.removeAttr("style");a(".btnChat").show();c.element.removeClass("chatBotActive");a(c.element).removeClass("height0");a(c.element).removeClass("height385");a(c.element).addClass("height40");a(".wc-shellinput").focus();a(".chatBotDiv").addClass("chatBotMinWidth")});a(document).on("click",".maxActive",function(d){d.preventDefault();a("#webchat").show();a(".wc-shellinput").focus();c.element.removeAttr("style");a(".btnChat").hide();a(".chatBotDiv").removeClass("chatBotMinWidth");if(a(".resize").hasClass("active")==false){c.element.removeClass("chatBotActive");a(c.element).removeClass("height0");a(c.element).removeClass("height40");a(c.element).addClass("height385")}else{c.element.addClass("chatBotActive");a(c.element).removeClass("height0");a(c.element).removeClass("height40");a(c.element).removeClass("height385")}});a(document).on("click",".faqDivWelcomeMsg",function(f){f.preventDefault();f.stopImmediatePropagation();var d=document.createElement("a");d.setAttribute("type","hidden");a(".chatBotDiv").removeClass("chatBotMinWidth");d.setAttribute("href",c.options.recentlyAskedQuestionsURL);d.setAttribute("target","_blank");d.innerHTML="link text";document.body.appendChild(d);d.click();d.remove()});a(document).on("keyup",".wc-shellinput",function(d){d.stopImmediatePropagation();if(a(this).val()==""){a(this).attr("dt-value",a(this).val())}if(d.which==8||d.which==46){a(this).attr("dt-value",a(this).val())}d.preventDefault()});a(document).on("click","img[alt='Narrowsearch']",function(d){d.stopImmediatePropagation();d.preventDefault();a(".narrowSearchIcn .serachTypeText").click()});var b;a(document).on("click",".readmoreDiv",function(k){b=a(this).parents("li.wc-carousel-item");var m=b.find(".subTitle").attr("dt-title");a(".popReadMore").remove();a(".wc-chatview-panel").append('<div class="popReadMore"></div>');a(".popReadMore").append("<div class='closePopup' title='Close'></div>");a(".popReadMore").append("<div class='popupContent'><p>"+m+"</p></div>");var j=b.find(".buttonContainer").length>0?b.find(".buttonContainer").attr("url"):"";if(j!=""){a(".popReadMore").append("<div class='visitDiv'><a href='#'>Visit Page</a></div>");a(document).on("click",".visitDiv",function(n){n.stopImmediatePropagation();n.preventDefault();b.find(".ac-pushButton").click()})}var d=b.parents(".wc-message-wrapper").attr("quid");var l=b.parents(".wc-message-wrapper").attr("ismeta");var f=b.find(".ac-ContainerParent").find(".mainTitle").attr("title");var g=b.find(".buttonContainer").length>0?b.find(".buttonContainer").attr("qnaid"):"";if(l=="meta"&&g!=""){j="m^"+j}else{if(l=="meta"){j="d^"+j}}if(g!=""){j=g+"^"+j}var h=j+" ~ "+f;if(a.inArray(h,c.raqValue)==-1){c.raqValue.push(h);a.ajax({url:c.options.saveAnswer,type:"POST",async:false,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({term:h,qId:parseInt(d)}),success:function(e){returnValue=e}})}});a(document).on("click",".closePopup",function(d){a(".popReadMore").remove()});a(document).on("click",function(d){if(!(a(d.target).hasClass("popReadMore")||a(d.target).parents(".popReadMore").length>0||a(d.target).hasClass("readmoreDiv"))){a(".popReadMore").remove()}})},dynamicallyLoadScript:function(c){if(a('head script[src="'+c+'"]').length==0){var b=document.createElement("script");b.src=c;document.head.appendChild(b)}},getIPAddress:function(c){var b=this;a.ajax({url:b.options.ipAddress,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(d){b.ipAddress=d.d}})},beforeSend:function(c){var b=this;if(b.options.isNarrowSearch){c.channelData.SearchType="narrowsearch"}else{if(b.options.isQnA){c.channelData.SearchType="qna"}else{if(b.options.isMetadata){c.channelData.SearchType="metadata"}}}if(b.options.chatBotDisable==false){c.channelData.ipAddress=b.ipAddress;c.channelData.productCodes=b.options.productCodeText;if((b.options.isNarrowSearch==true)&&((c.text=="Country")||(c.text=="Product")||(c.text=="Partner")||(c.text=="Indicator"))){a(".wc-shellinput").attr("disabled",false);a(".wc-shellinput").focus()}else{if(((b.startYear!=true)||(b.endYear!=true))&&((c.text=="Year")||(c.text=="End Year"))){if(c.text=="Year"){b.startYear=true}if(c.text=="End Year"){b.endYear=true}a(".wc-shellinput").attr("disabled",false);a(".wc-shellinput").focus()}else{if((b.options.isNarrowSearch==true)&&((c.text!="Country")||(c.text!="Product")||(c.text!="Partner")||(c.text!="Indicator")||(c.text!="Year")||(c.text!="End Year"))){a(".wc-shellinput").attr("placeholder","Please select a selection filter like Country, Product …");a(".wc-shellinput").focusout();a(".wc-shellinput").attr("disabled",true)}}}return c}},captchaTemplate:function(d,c){var b=widgetElement.options.botId;return'<div class="wc-message-wrapper list"><div class="wc-message wc-message-from-bot"><div class="wc-message-content"><svg class="wc-message-callout"><path class="point-left" d="m0,6 l6 6 v-12 z"></path><path class="point-right"></path></svg><div><div class="format-markdown"><p>'+c+'</p></div > <div class="wc-list"><img src="'+d+'"></div></div></div ></div > <div class="wc-message-from wc-message-from-bot"><span>'+b+" at "+this.getTime(new Date)+"</span></div></div >"},exitWizard:function(){var b=this;b.options.fromExit=true;setTimeout(function(){a("#dataSearch .serachTypeText").click()},100)},validQuestion:function(p){var q=this;var l=p.replace(/[^a-zA-Z ]/g,"");var h=a.grep(greetingsJson,function(s,r){return s.question.toLowerCase()==l.toLowerCase()});if(h.length==1&&!q.options.isNarrowSearch){n=q.messageFromYouTemplate("<span class='validationFirstLine' style='float:left;width:100%;padding: 5px 0px;'>"+p+" </span>","");a(".wc-message-group-content").append(n);a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000);a(".wc-shellinput").val("");n=q.messageTemplate("<span class='validationFirstLine' style='float:left;width:100%;line-height: 25px;'>"+greetingsAnswers[h[0].AnswerID]+" </span>","");a(".wc-message-group-content").append(n);a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000);a(".wc-shellinput").val("");return{allow:false,text:p}}else{var b=false;if(q.options.isNarrowSearch&&p=="Exit Wizard"){return{allow:true,text:p}}if(q.options.isNarrowSearch==true&&p!="narrow search"){var k=0;var d="";var e="";if(q.startYear==true||q.endYear==true){if(q.startYear==true?e="StartYear":e="EndYear"){}if(p=="exit"||p.toLowerCase()=="reset"){q.startYear=false;q.endYear=false;q.errorMessage=false;q.yearValidation=false;return{allow:true,text:p}}if(/^\d+$/.test(p)&&(p.length==4)){if(!(q.options.MinYear<=p&&p<=q.options.MaxYear)){if((k==0)){if(q.errorMessage==true){a(".wc-message-wrapper:last-child").remove()}var n=q.messageTemplate("Year should be between "+q.options.MinYear+" and "+q.options.MaxYear+".","error");q.errorMessage=true;q.yearValidation=true}}else{if(q.startYear==true){startYearValue=p;q.startYear=false;q.endYear=false;q.errorMessage=false;q.yearValidation=false;return{allow:true,text:p}}else{if(q.endYear==true){if(startYearValue>p){if((k==0)){var m="Please enter the";if((q.errorMessage==true)&&(!a(".wc-message-wrapper:last-child p:last").html().toLowerCase().startsWith(m.toLowerCase()))){a(".wc-message-wrapper:last-child").remove()}var n=q.messageTemplate("End Year entered is less than Start Year","error");q.errorMessage=true;q.yearValidation=true}}else{q.startYear=false;q.endYear=false;q.errorMessage=false;q.yearValidation=false;return{allow:true,text:p}}}}}}else{if((k==0)){var m="Please enter the";if((q.errorMessage==true)&&(!a(".wc-message-wrapper:last-child p:last").html().toLowerCase().startsWith(m.toLowerCase()))){a(".wc-message-wrapper:last-child").remove()}var n=q.messageTemplate("Please enter a valid year","error");q.errorMessage=true;q.yearValidation=true}}}else{if((q.autocompleteData!=null)&&(q.isPartner==true)){k=k+1;q.options.errorMessages="Partner";var c="";a.each(q.autocompleteData,function(s,r){if(r.name.toLowerCase()==p.toLowerCase()){c=p}});if(c.length>1){q.errorMessage=false;q.isCountry=false;q.isPartner=false;q.isProduct=false;q.isIndicator=false;return{allow:true,text:p}}}else{if((q.autocompleteData!=null)&&(q.isIndicator==true)){k=k+1;q.options.errorMessages="Indicator";var c="";a.each(q.autocompleteData,function(s,r){if(r.name.toLowerCase()==p.toLowerCase()){c=p}});if(c.length>1){q.errorMessage=false;q.isCountry=false;q.isProduct=false;q.isIndicator=false;q.isPartner=false;return{allow:true,text:p}}}else{if((q.autocompleteData!=null)&&(q.isCountry==true)){k=k+1;q.options.errorMessages="Country";var c="";a.each(q.autocompleteData,function(s,r){if(r.name.toLowerCase()==p.toLowerCase()){c=p}});if(c.length>1){q.errorMessage=false;q.isCountry=false;q.isPartner=false;q.isProduct=false;q.isIndicator=false;return{allow:true,text:p}}}else{if((q.autocompleteData!=null)&&(q.isProduct==true)){k=k+1;q.options.errorMessages="Product";var o="";if(p.indexOf("(")){a.each(q.autocompleteData,function(s,r){if(r.Entity.toLowerCase()==p.toLowerCase()){o=p}})}a.each(q.autocompleteData,function(w,v){var t=p.slice(0,p.indexOf("("));if(v.Entity.toLowerCase()==(t.toLowerCase())){var r=v.ProductGroupIndex.split("|");if((p.toLowerCase()).indexOf("(all sector)")>-1){o=v.Entity.toLocaleLowerCase()+"(All Sector)"}else{for(var s=0;s<r.length;s++){var u=r[s];a.each(q.productIndexData,function(y,x){if(x.Index.toLowerCase().startsWith(u.toLowerCase())){if((p.toLowerCase())==(v.Entity.toLocaleLowerCase()+"("+x.ProductGroupDescription.toLocaleLowerCase()+")")){o=x.ProductGroup}}})}}}});if(o.length>1){q.options.productCodeText=o;q.errorMessage=false;q.isCountry=false;q.isPartner=false;q.isProduct=false;q.isIndicator=false;return{allow:true,text:p}}}}}}}if(q.yearValidation!=true){if(p=="exit"||p.toLowerCase()=="reset"){q.options.productCodeText="";return{allow:true,text:p}}a(".wc-message-wrapper.error").remove();if(k==0){if(q.errorMessage==true){a(".wc-message-wrapper:last-child").remove()}var n=q.messageTemplate("Please select anyone of the below or click Exit Wizard to continue","error");q.errorMessage=true}else{var g=a(".wc-message-wrapper:last-child").text();var f="Please enter a valid "+q.options.errorMessages+" name";var j="Please enter a valid "+q.options.errorMessages+" name";if(g.indexOf(f)!=-1){if(q.errorMessage==true){a(".wc-message-wrapper:last-child").remove()}var n=q.messageTemplate(j,"error");q.errorMessage=true}else{var n=q.messageTemplate(j,"error");q.errorMessage=true}}}a(".wc-message-group-content").append(n);a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000);a(".wc-shellinput").val("");a(".wc-shellinput").focus();return{allow:b,text:p}}else{if(q.options.chatBotDisable==false){if(p==""){return{allow:b,text:p}}p=q.specialCharacterCheck(p);if((p=="narrow search"&&q.options.isNarrowSearch==true&&q.narrowText!=true)){b=true;return{allow:b,text:p}}else{q.questionCount+=1;q.captchaCount+=1;if(q.captcha==null){a.ajax({url:q.options.validEnitityUrl,type:"POST",data:JSON.stringify({term:p,count:q.captchaCount,isQnA:q.options.isQnA}),contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(t){t=JSON.parse(t.d);a(".error").remove();if((t.Captcha=="True")&&(q.options.isNarrowSearch==false)){t.Captcha=true;q.captcha=t;var r;r=q.captchaTemplate(t.Image,"Please enter the captcha to continue.");a(".wc-message-group-content").append(r);b=false}else{b=t[0]&&t[0].Column1>0?true:false;if(b==false){if(q.narrowText==true){if(q.startYear==true||q.endYear==true){r=q.messageTemplate("Please enter a valid year","error");q.errorMessage=true}else{r=q.messageTemplate("Please enter a valid "+q.options.errorMessages+" name","error");q.errorMessage=true}a(".wc-message-group-content").append(r)}else{var s=a(".welcomeMessages").clone();s.removeClass("welcomeMessages").addClass("error");r=s.find(".headmsg").html("<b>I am sorry, the question is not clear.</b>","error");a(".wc-message-group-content").append(s);a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000)}}else{}}a(".wc-shellinput").val("");a(".wc-shellinput").focus();a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000)}})}else{q.validateCaptcha(p);b=false}if(q.options.enableChatBotClose){if((parseInt(q.options.chatBotClosingCount)==q.questionCount)&&(q.options.isNarrowSearch==false)){setTimeout(function(){a("<div></div>").dialog({modal:true,resizable:false,title:"WITS Chat",dialogClass:"chatBotDialog",position:{my:"left top",at:"right bottom",of:"#webchat"},open:function(){var r=q.options.messageChatBotClosing;a(this).html(r)},buttons:{Ok:function(){a(this).dialog("destroy");a(".ui-dialog").remove();q.element.empty();q.destroy();a(q.element).removeClass("height40");a(q.element).removeClass("height385");a(q.element).removeClass("chatBotActive");a(q.element).addClass("height0");reCreate()}},close:function(){a(this).dialog("destroy");q.element.empty();q.destroy();a(q.element).removeClass("height40");a(q.element).removeClass("height385");a(q.element).removeClass("chatBotActive");a(q.element).addClass("height0");reCreate()}})})}}return{allow:b,text:p}}}else{return{allow:b,text:p}}}}},disableTextBox:function(){var b=this;if((b.options.chatBotDisable==false)&&(b.options.isNarrowSearch!=true)){a(".wc-shellinput").attr("disabled",false);a(".wc-shellinput").focus();a(".narrowSearchSpn").attr("disabled",false);a(".narrowSearchIcn").css("pointer-events","auto");a(".narrowSearchIcn").css("cursor","pointer");a(".narrowSearchIcn").removeAttr("readonly");a(".narrowSearchIcnNew").css("pointer-events","auto");a(".narrowSearchIcnNew").css("cursor","pointer");a(".narrowSearchIcnNew").removeAttr("readonly");a(".narrowSearchIcnText").css("pointer-events","auto");a(".narrowSearchIcnText").css("cursor","pointer");a(".narrowSearchIcnText").removeAttr("readonly")}},specialCharacterCheck:function(f){var b=this;var e="";var d=true;for(i=0;i<f.length;i++){var c=new RegExp("["+b.options.characterAllowed+"]","g");if(c.test(f[i])){e+=f[i];d=true}else{if(d){e+=" ";d=false}}}return e.trim()},validateCaptcha:function(c){var b=this;if(b.options.chatBotDisable==false){a.ajax({url:b.options.validCaptchaUrl,type:"POST",data:JSON.stringify({term:c,captcha:b.captcha.Text}),contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(e){if(e.d=="Success"){a(".wc-shellinput").val(b.captcha.SearchedText);b.captcha=null;b.captchaCount=-1;b.questionCount=b.questionCount-1;a(".wc-send").click()}else{e=JSON.parse(e.d);e.SearchedText=b.captcha.SearchedText;b.captcha=e;var d=b.captchaTemplate(e.Image,"Please enter a valid captcha.");a(".wc-message-group-content").append(d);a(".wc-shellinput").val("");a(".wc-message-groups").animate({scrollTop:a(".wc-message-group-content").height()},1000)}}})}},getTime:function(e){var c=this;var b=e.getHours();var f=e.getMinutes();var g=e.getSeconds();var d=b>=12?"PM":"AM";b=b%12;b=b?b:12;f=f<10?"0"+f:f;g=g<10?"0"+g:g;var h=b+":"+f+":"+g+" "+d;return h},setTime:function(e){var c=this;e=new Date(e);var b=e.getHours();var f=e.getMinutes();var g=e.getSeconds();var d=b>=12?"PM":"AM";b=b%12;b=b?b:12;f=f<10?"0"+f:f;g=g<10?"0"+g:g;var h=b+":"+f+":"+g+" "+d;return h},splitMainTitle:function(c){var b=this;var d=a(c).text();a(c).attr("title",d);if(d.length>b.options.trimMainTitle){a(c).text(d.substring(0,b.options.trimMainTitle)+"...")}else{a(c).text(d)}return c},splitSubTitle:function(d){var b=this;var c="";a(d).attr("title",a(d).text().split("/qna")[0].replace(/<[^>]*>?/gm,""));a(d).attr("dt-title",a(d).text().split("/qna")[0]);if(b.options.isQnA){a(d).addClass("subTitleForQnA");c=a(d).text().split("/qna")[0].replace(/<[^>]*>?/gm,"").substring(0,b.options.KBTrimSubTitle);a(d).html("<span class='subTitleSpn'>"+c+"...</span><span class='readmoreDiv' title='Read More'></span>")}else{var e=a(d).text().split("/qna")[0];if(b.options.isMetadata&&e!=""){if(a(d).text().length>b.options.KBTrimSubTitle){a(d).addClass("subTitleForQnA");c=a(d).text().split("/qna")[0].replace(/<[^>]*>?/gm,"").substring(0,b.options.KBTrimSubTitle);a(d).html("<span class='subTitleSpn'>"+c+"...</span><span class='readmoreDiv' title='Read More'></span>")}else{if(a(d).text().indexOf("/qna")>0){a(d).addClass("subTitleForQnA");c=a(d).text().split("/qna")[0].substring(0,b.options.KBTrimSubTitle);a(d).html("<span class='subTitleSpn'>"+c+"...</span><span class='readmoreDiv' title='Read More'></span>")}}}else{if(a(d).text().length>b.options.trimSubTitle){a(d).html(a(d).text().substring(0,b.options.trimSubTitle)+"...")}}}return d},allLoad:function(){a(".seachTypeTab").removeClass("disabled")},isMeta:function(c){var b=this;return b.options.isQnA==false&&b.options.isMetadata==true?"meta":""},afterSend:function(d){var b=this;a("img[alt='Narrowsearch']").css("cursor","pointer");a("img[alt='Narrowsearch']").attr({title:"Help me to narrow my search"});a("img[alt='NarrowSearchs']").css("cursor","pointer");a("img[alt='NarrowSearchs']").attr({title:"Help me to narrow my search"});if(d.text.trim()=="Please select the entity"){d.text=""}if(d.text.trim()==" "){d.text=""}if(d.text.toLowerCase()=="reset"||d.text.toLowerCase()=="exit"){b.options.reset=false}if(d.attachments&&d.attachments.length>0){var c=d.attachments[0].content.buttons[0].title;if(c=="qna"){a.each(d.attachments,function(g,h){h.content.subtitle=h.content.subtitle+"/qna"})}}if(d.text=="Exit Wizard"){if(b.exitWizad==true){if(a(".wc-message-group-content > .wc-message-wrapper:last-child").find(".format-plain span").text()=="Exit Wizard"){a(".wc-message-group-content > .wc-message-wrapper:last-child").remove()}b.exitWizad=false;b.narrowText=false}else{b.exitWizad=true}}else{if(d.text=="narrow search"){b.narrowText=true}}if(a(".ac-pushButton").length>0){for(i=0;i<a(".ac-pushButton").length;i++){if((a(".ac-pushButton")[i].innerHTML).indexOf("Reset")!=-1){a(a(".ac-pushButton")[i]).css("color","blue")}else{if(!(a(".ac-pushButton")[i].innerHTML=="View")){a(a(".ac-pushButton")[i]).css("color","green")}}}}if(d.text=="Please enter the Country *or type 'reset' to go back*"&&d.from.name==b.options.botId){b.autoComplete("Country");b.options.reset=true}else{if(d.text=="Please enter the Partner *or type 'reset' to go back*"&&d.from.name==b.options.botId){b.autoComplete("Partner");b.options.reset=true}else{if(d.text=="Please enter the Product *or type 'reset' to go back*"&&d.from.name==b.options.botId){b.autoComplete("Product");b.options.reset=true}else{if(d.text=="Please enter the Indicator  *or type 'reset' to go back*"&&d.from.name==b.options.botId){b.autoComplete("Indicator");b.options.reset=true}else{if(a(".wc-shellinput").hasClass("ui-autocomplete-input")&&d.from.name==b.options.botId&&d.text!=""){a(".wc-shellinput").autocomplete("destroy");b.options.reset=false}}}}}if((d.text.indexOf("Country")!=-1)&&(d.text.indexOf("Partner")!=-1)&&(d.text.indexOf("Product")!=-1)&&(d.text.indexOf("Indicator")!=-1)&&(d.text.indexOf("Start Year")!=-1)&&(d.text.indexOf("End Year")!=-1)&&(d.text.indexOf("Reset")==-1)){a(".wc-shellinput").attr("placeholder","Click Reset/Exit to continue.")}else{if(d.text.indexOf("Reset")!=-1){a(".wc-shellinput").attr("placeholder","Please select a selection filter like Country, Product …")}}var e=a(".blueDesign .blueButton").length;var f=a(".wc-suggested-actions ul button").length;if(e==(f-1)){a(".wc-message-groups").addClass("topActive")}else{if(e==(f-2)){a(".wc-message-groups").removeClass("topActive")}else{if(e==(f-5)){a(".wc-message-groups").addClass("topActiveSmall")}}}if((f>6)&&(screen.width>900)&&(e==(f-1))){a(".wc-message-groups").addClass("topActiveFirstReset")}else{if((f>6)&&(screen.width>900)&&(e==(f-3))){a(".wc-message-groups").removeClass("topActiveFirstReset")}}a(".ac-image").attr("onmousedown","return false");var b=this;if(b.options.chatBotDisable==false){if(d.dateParsed==undefined){if(d.from.id==b.options.user){d.timestamp=b.setTime(d.timestamp)}else{d.timestamp=b.getTime(new Date)}d.dateParsed=true}a(".error").remove();return d}},raqValue:[],saveAnswer:function(g,c){var m=this;var b=g.items[0].title;if(m.options.chatBotDisable==false&&b!="qna"){var h=g.items[0].url;var l=a(c).parents(".wc-message-wrapper").attr("quid");var f=a(c).parents(".wc-message-wrapper").attr("ismeta");var d=a(c).parents(".ac-ContainerParent").find(".mainTitle").attr("title");var k=a(c).parents(".buttonContainer").attr("qnaid");if(f=="meta"&&k!=""){h="m^"+h}else{if(f=="meta"){h="d^"+h}}if(k!=""){h=k+"^"+h}var j=h+" ~ "+d;if(a.inArray(j,m.raqValue)==-1){m.raqValue.push(j);a.ajax({url:m.options.saveAnswer,type:"POST",async:false,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({term:j,qId:parseInt(l)}),success:function(e){returnValue=e}})}}}})})(jQuery);function searchClick(a){switch(a){case"datasearch":$(".dataSearch .serachTypeText").click();break;case"narrowsearch":$(".narrowSearchIcn .serachTypeText").click();break;case"kbsearch":$(".qnaSearch .serachTypeText").click();break}}function onOffChange(){document.getElementById("myonoffswitch").click()};